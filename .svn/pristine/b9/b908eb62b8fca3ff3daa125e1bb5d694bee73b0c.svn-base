<?php
// +----------------------------------------------------------------------
// | API控制器
// +----------------------------------------------------------------------
// | Copyright (c) 2017--20xx年 捞月狗. All rights reserved.
// +----------------------------------------------------------------------
// | File:     api.php
// |
// | Author:   huzhichao@laoyuegou.com
// | Created:  2017-xx-xx
// +----------------------------------------------------------------------

class LanguageController extends BaseController 
{

 /*   public function notfoundAction() 
    {
        $this->redirect('/index.html?language=zh_cn&category=lol');
    } */


/*	public function indexAction() 
	{
        $language = $this ->request->get("language");
        $category = $this ->request->get("category");
        $search   = $this ->request->get("search");

        if(empty($language)) {

            $language = empty($language) ? 'zh_cn' : $language;
        }

        $language = strtolower($language);
        
        $LanguageModel = new LanguageModel();

        $messages = $LanguageModel->index( $language, $category, $search );


        foreach ($messages as $key => &$value) {
           $value['gname'] = htmlspecialchars($value['gname']);
        }

        $search = htmlspecialchars($search);
    
        $this -> assign('language',$language);

        $this -> assign('category',$category);

        $this -> assign('languages',$LanguageModel->getLanguage());

        $this -> assign('categorys',$LanguageModel->getCategory());

        $this -> assign('search',$search);

        $this -> assign('messages',$messages);

    	$this->pages->init('首页', '展示');
    }*/



  /*  public function  updateAction() 
    {
        $language = $this ->request->getPost("language");
        $category = $this ->request->getPost("category");
        $key_id   = $this ->request->getPost("key_id");
        $idx      = $this ->request->getPost("idx");
        $namex    = $this ->request->getPost("namex");

        try{

            $LanguageModel = new LanguageModel();

            $LanguageModel->update( $language, $category, $key_id, $idx, $namex );

            return $this->success('ok');
        
        }catch (\Exception $e) {
            return $this->success('error', $e->getMessage());
        }


    }*/

/*
    public function addAction()
    {
        $language = $this ->request->getPost("language");
        $category = $this ->request->getPost("category");
        $aid      = $this ->request->getPost("aid");
        $aname    = $this ->request->getPost("aname");

        try{

            $LanguageModel = new LanguageModel();

            $LanguageModel->add( $language, $category, $aid, $aname );

            return $this->success('ok');
        
        }catch (\Exception $e) {
            return $this->success($e->getMessage());
        }

    }*/

    /**
    * 导入Excel数据
    * @return {json}
    * @param  
    * @author huzhichao@laoyuegou.com
    * @link   
    * @date   
    */
  /*  public function excelAction()
    {
        try{
            $language = $this ->request->getPost("language");
            $category = $this ->request->getPost("category");

            $file = $this->request->getUploadedFiles()['0'];

            if($file -> isUploadedFile()) {
                //var_dump($file);exit;
                $type = $file -> getExtension();
                $size = $file -> getSize();
                $ext  = $file -> getExtension();

                //随机声称文件名与创建上传文件夹
                $da       = date('Ymd', time());
                $upload   = $this->config->upload;
                $path     = ROOT_PATH . "{$upload->rootPath}{$da}";
                Common::create_file_dir($path);
                $identify = uniqid() . ".{$ext}";
                $img_url  = $upload->rootPath.$da.'/'.$identify;
                $filename = $path . '/' . $identify ;
                //过滤文件
                if (!in_array(strtolower($type), $upload -> mimes -> toArray())){
                    throw new Exception("文件类型[{$type}]不支持上传！");
                }
                if ($size > $upload -> maxSize){
                    throw new Exception('文件大小超出！');
                }
                // 保存文件到上传目录下
                $file -> moveTo($filename);

                $LanguageModel = new LanguageModel();
                
                $sheet = $LanguageModel->getSheet( $category );

                if($sheet == -1) {
                    throw new \Exception("未找到该游戏", 1);
                }

                $res = $this->importExecl($filename, $sheet);

                //var_dump($res);exit;

                $LanguageModel->import( $language, $category, $res );

            }
            $this->redirect("/index.html?language={$language}&category={$category}");
        
        }catch (\Exception $e) {
            var_dump($e->getMessage());exit;
            return $this->success($e->getMessage());
        }

    }*/


    /** 
    *  数据导入 
    * @param string $file excel文件 
    * @param string $sheet 
    * @return string   返回解析数据 
    * @throws PHPExcel_Exception 
    * @throws PHPExcel_Reader_Exception 
    */  
  /*  private function importExecl($file='', $sheet=0){  

        $file = iconv("utf-8", "gb2312", $file);   //转码  
        if(empty($file) OR !file_exists($file)) {  
            die('file not exists!');  
        }  
        include(ROOT_PATH  . '/app/librarys/PHPExcel.php');  //引入PHP EXCEL类  
        $objRead = new PHPExcel_Reader_Excel2007();   //建立reader对象  
        if(!$objRead->canRead($file)){  
            $objRead = new PHPExcel_Reader_Excel5();  
            if(!$objRead->canRead($file)){  
                die('No Excel!');  
            }  
        }  
      
        $cellName = array('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'AA', 'AB', 'AC', 'AD', 'AE', 'AF', 'AG', 'AH', 'AI', 'AJ', 'AK', 'AL', 'AM', 'AN', 'AO', 'AP', 'AQ', 'AR', 'AS', 'AT', 'AU', 'AV', 'AW', 'AX', 'AY', 'AZ');  
      
        $obj       = $objRead->load($file);  //建立excel对象  
        $currSheet = $obj->getSheet($sheet);   //获取指定的sheet表  
        //$columnH   = $currSheet->getHighestColumn();   //取得最大的列号  
        $columnH   = 'F';  //给最大列为F   目前我们只支持 cn  us   tw  预留一个
        $columnCnt = array_search($columnH, $cellName);  
        $rowCnt    = $currSheet->getHighestRow();   //获取总行数  
      
        $data = array();  
        for($_row=1; $_row<=$rowCnt; $_row++){  //读取内容  
            for($_column=0; $_column<=$columnCnt; $_column++){  
                $cellId = $cellName[$_column].$_row;  
                $cellValue = $currSheet->getCell($cellId)->getValue();  
                 //$cellValue = $currSheet->getCell($cellId)->getCalculatedValue();  #获取公式计算的值  
                if($cellValue instanceof PHPExcel_RichText){   //富文本转换字符串  
                    $cellValue = $cellValue->__toString();  
                }  
      
                $data[$_row][$cellName[$_column]] = $cellValue;  
            }  
        }  
      
        return $data;  
    }*/  







    

}
